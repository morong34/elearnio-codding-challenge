<div class="cart-container">
  <button
    mat-fab
    color="primary"
    class="cart-toggle-button"
    [matBadge]="_cartService.totalItems()"
    matBadgeColor="accent"
    [matBadgeHidden]="_cartService.totalItems() === 0"
    (click)="toggleCart()">
    <mat-icon>shopping_cart</mat-icon>
  </button>

  <div class="cart-sidebar" [class.open]="isOpen()">
    <div class="cart-header">
      <h2>Your Cart</h2>
      <button mat-icon-button (click)="closeCart()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="cart-content">
      @if (_cartService.cartItemsValues().length) {
        <div class="cart-items">
          @for (item of _cartService.cartItemsValues(); track item.product.id) {
            <div class="cart-item">
              <div class="item-image">
                <img [ngSrc]="item.product.image" width="1" height="1" [alt]="item.product.title" loading="lazy">
              </div>
              <div class="item-details">
                <h3>{{ item.product.title }}</h3>
                <p class="item-price">${{ (item.product.price * item.quantity).toFixed(2) }}</p>
                <div class="quantity-controls">
                  <button mat-icon-button (click)="decrementQuantity(item)">
                    <mat-icon>remove</mat-icon>
                  </button>
                  <span class="quantity">{{ item.quantity }}</span>
                  <button mat-icon-button (click)="incrementQuantity(item)">
                    <mat-icon>add</mat-icon>
                  </button>
                </div>
              </div>
              <button mat-icon-button color="warn" class="remove-button" (click)="removeItem(item.product.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          }
        </div>

        <div class="cart-summary">
          <div class="cart-total">
            <span>Total:</span>
            <span class="total-price">${{ _cartService.totalPrice().toFixed(2) }}</span>
          </div>
          <button mat-raised-button color="warn" (click)="clearCart()">Clear Cart</button>
          <button mat-raised-button color="primary">Checkout</button>
        </div>
      } @else {
        <div class="empty-cart">
          <mat-icon class="empty-cart-icon">shopping_cart</mat-icon>
          <p>Your cart is empty</p>
          <button mat-raised-button color="primary" (click)="closeCart()">Continue Shopping</button>
        </div>
      }
    </div>
  </div>

  <div
    class="cart-overlay"
    [class.visible]="isOpen()"
    (click)="closeCart()">
  </div>
</div>
